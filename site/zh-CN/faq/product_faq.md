---
id: product_faq.md
---

# 产品常见问题


<!-- TOC -->

- [Milvus 会收费吗？](#Milvus-会收费吗)
- [Milvus 支持非 x86 平台吗？](#Milvus-支持非-x86-平台吗)
- [Milvus 与其他向量检索工具对比如何？](#Milvus-与其他向量检索工具对比如何)
- [Milvus 支持对向量的插入、删除、更改和查询操作吗？](#Milvus-支持对向量的插入删除更改和查询操作吗)
- [Milvus 可以处理百亿或千亿级数据吗？](#Milvus-可以处理百亿或千亿级数据吗)
- [Milvus 数据存储在哪里？](#Milvus-数据存储在哪里)
- [为什么我在 SQLite / MySQL 找不到向量数据？](#为什么我在-SQLite--MySQL-找不到向量数据)
- [Milvus 的元数据存储可以使用 SQL Server 或者 PostgreSQL 吗？](#Milvus-的元数据存储可以使用-SQL-Server-或者-PostgreSQL-吗)
- [Milvus 的 Python SDK 有连接池吗？](#Milvus-的-Python-SDK-有连接池吗)
- [Milvus 是否支持 “边插入边查询” ？](#Milvus-是否支持-边插入边查询)
- [Milvus 是否有可视化管理工具？](#Milvus-是否有可视化管理工具)
- [Milvus 有没有数据导出的功能？](#Milvus-有没有数据导出的功能)
- [为什么我通过 `get_entity_by_id` 获取的向量精度损失了？](#为什么我通过-get_entity_by_id-获取的向量精度损失了)
- [Milvus 服务本身所占据的内存大小是不是不会超过 `cache.cache_size` 和 `cache.insert_buffer_size` 总和大小？](#Milvus-服务本身所占据的内存大小是不是不会超过-cache.cache_size-和-cache.insert_buffer_size-总和大小)
- [向 Milvus 中导入数据时，应该自己指定 `entity id` 还是由 Milvus 自动生成 `entity id`？](#向-Milvus-中导入数据时应该自己指定-entity-id-还是由-Milvus-自动生成-entity-id)
- [Milvus 中自定义 ID 有没有长度限制？](#Milvus-中自定义-ID-有没有长度限制)
- [为什么 `metric type` 是 IP 时搜索出来的 `top1` 不是向量本身？](#为什么-metric-type-是-IP-时搜索出来的-top1-不是向量本身)
- [集合分区后，查询性能能得到隔离吗？比如当集合足够大（1 亿数据），新增一个分区，分区只有一万，这个一万数据的分区的查询效率会受一亿数据的影响吗？](#集合分区后查询性能能得到隔离吗比如当集合足够大1-亿数据新增一个分区分区只有一万这个一万数据的分区的查询效率会受一亿数据的影响吗)
- [如果只是搜索集合中的部分分区，整个集合的数据会全部加载到内存吗？](#如果只是搜索集合中的部分分区整个集合的数据会全部加载到内存吗)
- [查询时，对各个分段的检索是并行处理的吗？](#查询时对各个分段的检索是并行处理的吗)
- [Milvus 中如何选择向量索引的类型？](#Milvus-中如何选择向量索引的类型)
- [Milvus 可以在不同分区上建立不同索引吗？](#Milvus-可以在不同分区上建立不同索引吗)
- [Milvus 中同一个集合可以建立不同的索引吗？](#Milvus-中同一个集合可以建立不同的索引吗)
- [Milvus 中支持新增向量后再建索引吗？](#Milvus-中支持新增向量后再建索引吗)
- [索引 IVF_SQ8 和 IVF_SQ8H 在召回率上有区别吗，哪个召回率更高?](#索引-IVF_SQ8-和-IVF_SQ8H-在召回率上有区别吗哪个召回率更高)
- [Milvus 中 FLAT 索引和 IVF_FLAT 索引的原理比较？](#Milvus-中-FLAT-索引和-IVF_FLAT-索引的原理比较)
- [刚建完索引后，为什么内存会增长？](#刚建完索引后为什么内存会增长)
- [Milvus 合并数据是通过什么方式实现的？](#Milvus-合并数据是通过什么方式实现的)
- [Milvus 中 `index_file_size` 和 `metric_type` 支持后续修改吗？](#Milvus-中-index_file_size-和-metric_type-支持后续修改吗)
- [向量插入后自动落盘间隔时间是多少？](#向量插入后自动落盘间隔时间是多少)
- [如果设置了 `preload_collection`，必须是等集合全部加载到内存，服务才能访问吗？](#如果设置了-preload_collection必须是等集合全部加载到内存服务才能访问吗)
- [什么是 compact 操作？](#什么是-compact-操作)
- [插入数据时 Milvus 的落盘逻辑是怎样的？是一次无论插入多少，定时落盘？还是达到一定量，再落盘？还是定时和数据量阈值两个标准？](#插入数据时-Milvus-的落盘逻辑是怎样的是一次无论插入多少定时落盘还是达到一定量再落盘还是定时和数据量阈值两个标准)
- [Mishards 推荐的配置是什么？](#Mishards-推荐的配置是什么)
- [Mishard 支持 RESTful API 吗？](#Mishard-支持-RESTful-API-吗)
- [什么是归一化？Milvus 中为什么有时候需要归一化？](#什么是归一化Milvus-中为什么有时候需要归一化)
- [为什么欧氏距离和内积在计算向量相似度时的结果不一致？](#为什么欧氏距离和内积在计算向量相似度时的结果不一致)
- [Milvus 对集合和分区的数量有限制吗？](#Milvus-对集合和分区的数量有限制吗)
- [为什么检索结果中出现 ID 为 -1 的向量？](#为什么检索结果中出现-ID-为--1-的向量)
- [仍有问题没有得到解答？](#仍有问题没有得到解答)





<!-- /TOC -->

#### Milvus 会收费吗？

Milvus 会一直走开源路线的，现有的版本都不会收费，我们的开源项目也一直会维护下去的。

项目开源，请遵循 [Apache 2.0 协议](http://www.apache.org/licenses/LICENSE-2.0) 使用。

#### Milvus 支持非 x86 平台吗？

目前不支持。

#### Milvus 与其他向量检索工具对比如何？

与其他向量检索工具对比，Milvus 是唯一一款高性能、易用性强的向量检索引擎，具备高可用、弹性扩展等特性。

#### Milvus 支持对向量的插入、删除、更改和查询操作吗？

支持向量的插入、删除、和查询操作。对向量的修改可以通过先删除再插入来实现。


#### Milvus 可以处理百亿或千亿级数据吗？

Milvus 提供了集群分片中间件 Mishards，可以实现集群分片部署，满足百亿或者千亿级数据的处理需求。


#### Milvus 数据存储在哪里？

向量数据导入 Milvus 后，将自动存储在本地磁盘的 **milvus/db/tables/** 这个路径下。详见 [服务端配置](milvus_config.md)。

元数据可以存储在 MySQL 或 SQLite 上。详见 [使用 MySQL 管理元数据](data_manage.md)。


#### 为什么我在 SQLite / MySQL 找不到向量数据？

SQLite / MySQL 只是存放原始向量数据的元数据。向量和索引直接以文件的形式存在磁盘上，不存放在 SQLite 或 MySQL里。详见 [存储相关概念](storage_concept.md)。

#### Milvus 的元数据存储可以使用 SQL Server 或者 PostgreSQL 吗？

不可以，目前仅支持 SQLite 和 MySQL。

#### Milvus 的 Python SDK 有连接池吗？

Milvus 0.9.0 及更高版本对应的 Python SDK 有连接池。连接池的默认连接数量没有上限。

#### Milvus 是否支持 “边插入边查询” ？

支持。

#### Milvus 是否有可视化管理工具？

从 Milvus 0.7.0 开始有 [Milvus Enterprise Manager](https://zilliz.com/products/em) 提供图形管理功能。

#### Milvus 有没有数据导出的功能？

目前没有专门的工具实现该功能。你可以使用相应的 API 来实现。通过 `get_entity_by_id` 得到指定 ID 对应的向量。


#### 为什么我通过 `get_entity_by_id` 获取的向量精度损失了？

Milvus 内部存储的向量的每个维度都是用一个 `float` 单精度来存储的，最多精确到小数点后 7 位。如果输入时给了双精度，导入 Milvus 之后都存为单精度了（小数点后七位）。这种情况下用 `get_entity_by_id` 取出的向量，是以单精度保存的向量，会出现精度损失的情况。另外，所有的计算都是以单精度进行的。

#### Milvus 服务本身所占据的内存大小是不是不会超过 `cache.cache_size` 和 `cache.insert_buffer_size` 总和大小？

`cache.cache_size` 只是搜索用到的数据占据内存的最大使用量。`insert_buffer_size` 是插入数据时占用内存的最大使用量。 除此以外，建索引会额外使用部分内存，程序运行过程中由于有些环节有数据临时拷贝，也会在短时间内额外占用一些内存。 Milvus 并没有一启动就申请一片固定的内存空间，所以内存的使用不是严格限定在一个数值内。

#### 向 Milvus 中导入数据时，应该自己指定 `entity id` 还是由 Milvus 自动生成 `entity id` ？

两种方法均可。但是，在一个集合内的向量必须全部使用用户指定的 `entity id` 或者全部使用自动生成的 `entity id`。

#### Milvus 中自定义 ID 有没有长度限制？

ID 类型是非负的 64 位整型。

#### Milvus 中每次插入数据有上限吗？

每次插入数据不能超过 256 MB。

#### 为什么 `metric type` 是 IP 时搜索出来的 `top1` 不是向量本身？

向量计算距离用 IP 时，如果向量未归一化，会出现这样的情况。

#### 集合分区后，查询性能能得到隔离吗？比如当集合足够大（1 亿数据），新增一个分区，分区只有一万，这个一万数据的分区的查询效率会受一亿数据的影响吗？

不会。搜索的时候指定分区的话，就只会在这个分区里进行检索。

#### 如果只是搜索集合中的部分分区，整个集合的数据会全部加载到内存吗？

不会，只加载指定的分区里的数据。


#### 查询时，对各个分段的检索是并行处理的吗？

单个分段内并行计算，多个分段间是串行处理的。CPU 版本和 GPU 版本有些不一样。

如果一个集合里有多个分段, 当有查询请求到达时：

- 对于 CPU 版本，会先把第一个分段数据读进来，然后 CPU 在这个分段内并行查询，同时读取第二个分段。第一个分段计算完后，才开始计算第二个分段。

- GPU 版本允许多个 GPU 设备同时计算。如果用了两个 GPU，那么第一轮会先把第一、第二个分段分别读进 GPU，每个 GPU 计算一个分段，第二轮读进第三、第四个分段 ……

可参阅文章：[Milvus 开源向量搜索引擎 ANNS](https://zhuanlan.zhihu.com/p/110332250)。

#### Milvus 中如何选择向量索引的类型？

索引需要根据具体场景和需求去选择。可参阅文档 [选择向量索引工具](vector_db.md) 和文章 [如何选择索引类型](https://milvus.io/cn/blogs/2019-12-03-select-index.md)。

#### Milvus 可以在不同分区上建立不同索引吗？

不可以。索引只针对集合，不针对分区。

#### Milvus 中同一个集合可以建立不同的索引吗？

不可以。一个集合允许有多类数据，但只能有一个索引。

#### Milvus 中支持新增向量后再建索引吗？

支持。Milvus 中数据是分文件存储的，后续新增向量会存在新的数据文件中。达到一定量后该文件会自动触发建立索引，会生成一个新的索引文件，不会影响之前已经建立过索引的数据。


#### 索引 IVF_SQ8 和 IVF_SQ8H 在召回率上有区别吗，哪个召回率更高?

没有区别。

#### Milvus 中 FLAT 索引和 IVF_FLAT 索引的原理比较？

把 FLAT 和 IVF_FLAT 做比较，可以这么估算：

已知 IVF_FLAT 索引是把向量分成 `nlist` 个桶。假设用默认的 `nlist` = 16384，搜索的时候是先用目标向量和这 16384 个中心点计算距离，得到最近的 `nprobe` 个桶，再在桶里计算最近向量。而 FLAT 是每条向量和目标向量计算距离。

所以当总的向量条数约等于 `nlist` 时，两者的计算量相当，性能也差不多。而随着向量条数达到 `nlist` 的 2 倍、3 倍、n 倍之后，IVF_FLAT 的优势就越来越大。

详见文档 [选择向量索引工具](vector_db.md)。

#### 刚建完索引后，为什么内存会增长？

比如有一个 2 GB 的原始向量文件，这时还没建索引。查询的时候会把这 2 GB 数据读到内存里，占用 2GB 内存。然后建 IVF_FLAT 索引，建好后生成一个 2 GB 的索引文件到硬盘。再次查询，就会把这 2 GB 索引数据也读到内存里。加上刚才的原始数据，就有 4 GB 的占用。如果没有达到`cache.cache_size` 的上限，前面那个 2 GB 的原始数据是不会从内存中清除的。



#### Milvus 合并数据是通过什么方式实现的？

比如在 t1 时间点插入了 1 兆数据，然后落盘成为文件 f1。接着在 t2 时间点插入了 1 兆数据，落盘成为文件 f2。这时有两个数据文件。后台发现有两个文件可以合并，于是会把这两个文件拿来合并，合并成文件 f3。

在 f3 成功落盘之前，f1 和 f2 仍然是可使用状态，也就是可以用来做查询。一旦 f3 落盘成功并改写了元数据，f1 和 f2 就会被标记成删除状态，这时由 f3 来承担查询。

合并文件时，把 f1 和 f2 读入内存，然后把两段数据合成一段，落盘成为 f3。所以这次合并的 I/O 是 2 兆读 2 兆写。当数据量累积较大的时候，比如 `index_file_size` = 1024 兆，数据累积到 1023 兆时，如果继续插入 1 兆数据，就会有 1024 兆的读和 1024 兆的写。

详见 [存储操作 > 数据合并](storage_operation.md#数据合并)。


#### Milvus 中 `index_file_size` 和 `metric_type` 支持后续修改吗？

不支持更改。

#### 向量插入后自动落盘间隔时间是多少？

1 秒。

#### 如果设置了 `preload_collection`，必须是等集合全部加载到内存，服务才能访问吗？

是的。如果是在 `server_config` 里设置的，那就会在启动 Milvus 的时候加载好数据后才开始提供服务。


#### 什么是 compact 操作？

compact 操作是把被删除的向量去掉，重新写一个文件，代价比较大。在 0.9.0 及以后，只有当被删除的向量达到文件的 10% 以上，compact 才会有效。

详见 [存储操作 > 数据段整理](storage_operation.md#数据段整理)。


#### 插入数据时 Milvus 的落盘逻辑是怎样的？是一次无论插入多少，定时落盘？还是达到一定量，再落盘？还是定时和数据量阈值两个标准？

插入时把数据写到缓存，定时地把缓存里的数据落盘。如果调用 `flush`，也会触发落盘的动作。

详见 [存储操作 > 数据落盘](storage_operation.md#数据落盘)。

#### Mishards 推荐的配置是什么？

推荐写节点用 GPU 版的 Milvus，读节点用 CPU 版的 Milvus。比如现在只能用单个写节点，这个写节点可以配置 GPU 资源用来建索引，读节点都配置成 CPU 节点。但这方面是不做限制的，每个节点就是一个执行单元，不管是 GPU 还是 CPU 都可以。

#### Mishard 支持 RESTful API 吗？

目前不支持。

#### 什么是归一化？Milvus 中为什么有时候需要归一化？

归一化是使向量的模长等于一。归一化后，针对同一个向量，在同等搜索空间的条件下，欧氏距离返回的前 k 个距离最近的向量结果集，与内积返回的前 k 个相似度最大的向量结果集是等价的。

可参阅文章 [向量搜索的简明数学基础](https://zhuanlan.zhihu.com/p/88117781)。

#### 为什么欧氏距离和内积在计算向量相似度时的结果不一致？

如果欧氏距离和内积返回不一致的结果，需要检查数据是否已经归一化。如果没有，请先对数据进行归一化。理论上可以证明，对于未归一化的数据，欧氏距离和内积的结果是不一致的。


#### Milvus 对集合和分区的数量有限制吗？

有。限制为 4096。

#### 为什么检索结果中出现 ID 为 -1 的向量？

当数据集中的向量数目少于 `topk` 时，Milvus 会自动向结果中添加 ID 为 -1 的向量，以保证检索结果的数量等于 `topk`。

#### 为什么搜索 `topk` 向量，结果不到 k 条向量？

在 Milvus 支持的索引类型中，IVF_FLAT 和 IVF_SQ8 是基于 k-means 空间划分的分桶搜索算法。空间被分为 `nlist` 个桶，导入的向量被分配存储在基于 `nlist` 划分的文件结构中。搜索发生时，只搜索最近似的 `nprobe` 个桶。

如果 `nlist` 和 k 比较大，而 `nprobe` 又足够小，有可能出现 `nprobe` 文件中的所有向量总数小于 k。当搜索 `topk` 向量时，就会出现搜索结果小于 k 条向量的情况。

想要避免这种情况，可以尝试将 `nprobe` 设置为更大值，或者把 `nlist` 和 `k` 设置为更小值。

详见 [索引类型](index.md)。






#### 仍有问题没有得到解答？

如果仍有其他问题，你可以：

- 在 GitHub 上访问 [Milvus](https://github.com/milvus-io/milvus/issues)，提问、分享、交流，帮助其他用户。
- 加入我们的 [Slack 社区](https://join.slack.com/t/milvusio/shared_invite/enQtNzY1OTQ0NDI3NjMzLWNmYmM1NmNjOTQ5MGI5NDhhYmRhMGU5M2NhNzhhMDMzY2MzNDdlYjM5ODQ5MmE3ODFlYzU3YjJkNmVlNDQ2ZTk)，与其他用户讨论交流。

